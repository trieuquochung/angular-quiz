rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Questions collection - Public read only
    // Admins manage questions via Firebase Console
    match /questions/{questionId} {
      allow read: if true;
      allow write: if false; // Only admins can add/edit via Firebase Console
    }
    
    // Quiz results - Anyone can submit, no one can read others' results
    match /quizResults/{resultId} {
      allow create: if true; // Anyone can submit quiz results
      allow read: if false;  // Privacy: no reading others' results
      allow update, delete: if false; // No modifications after submission
    }
    
    // Statistics collection (optional - for aggregated data)
    match /statistics/{statId} {
      allow read: if true;   // Public statistics
      allow write: if false; // Updated manually by admin
    }
    
    // Rate limiting: Prevent spam submissions (basic protection)
    match /quizResults/{resultId} {
      allow create: if request.time > resource.data.lastSubmission + duration.value(5, 's')
        || resource == null;
    }
  }
}